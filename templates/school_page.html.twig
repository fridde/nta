{% extends "base.html.twig" %}

{% block body %}

    {% macro staff_row(user_id, user_data, hidden = false) %}
        <tr data-id="{{ user_id }}"{% if hidden %} class="d-none"{% endif %}>

            <td data-field="FirstName">{{- user_data[0] -}}</td>
            <td data-field="LastName">{{- user_data[1] -}}</td>
            <td data-field="Mail">{{ user_data[2] }}</td>
            <td>
                {% for topic_id, q in user_data[3] %}
                    <span class="badge bg-success" title="{{ q.Topic.Name }}">{{ topic_id|upper }}
                        {#                        <span class="tooltiptext"> #}
                        {#                            {{ q.Topic.Name }} #}
                        {#                        </span> #}
                    </span>
                {% endfor %}
            </td>
            <td>
                <button class="btn btn-outline-primary edit-staff-row-btn" type="button">
                    <i class='bx bxs-user-detail'></i>
                </button>
            </td>
        </tr>
    {% endmacro %}

    <div {{ stimulus_controller('adduserdialog') }}>
        <dialog data-adduserdialog-target="dialog">
            <h1>This is the dialog!</h1>
            <button type="button" data-action="dialog#close">Cancel</button>
        </dialog>

        <span id="staff-table-anchor" class="anchor"></span>
        <h1>Pedagoger</h1>
        <div class="position-relative">
            <div class="position-absolute top-0 start-0">
                <button class="btn btn-primary" id="add-staff-member-btn" data-action="dialog#open">
                    <i class='bx bx-user-plus'></i>
                    Lägg till pedagog
                </button>
            </div>
        </div>

        <div class="mt-5">
            <table class="table table-sm table-hover" id="staff-table">
                <thead>
                <tr>
                    <th>Förnamn</th>
                    <th>Efternamn</th>
                    <th>Mejl</th>
                    <th>Kompetenser</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                {% for user in users -%}
                    {% set user_data = [user.FirstName, user.LastName, user.Mail, user.QualificationsAsArray] %}
                    {{ _self.staff_row(user.id, user_data) }}
                {%- endfor %}
                {{ _self.staff_row("new", ["", "", "", []], true) }}
                </tbody>
            </table>
        </div>
    </div>

    <h1>Lådbokningar</h1>
    <div class="accordion">
        {% for period_id, current_bookings in bookings %}
            {% set period = formatted['periods'][period_id] %}
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" data-bs-toggle="collapse"
                            data-bs-target="#{{ period_id }}">{{ period }}</button>
                </h2>
                <div id="{{ period_id }}" class="accordion-collapse collapse {{ period.isCurrentOrNext ? 'show' }}">
                    <div class="accordion-body">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Tema</th>
                                <th>Lärare</th>
                                <th>Antal lådor</th>
                                <th>Antal elever</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for booking in current_bookings %}
                                <tr>
                                    <td>{{ booking.Topic.Name }}</td>
                                    <td>{{ booking.BoxOwner.FullName }}</td>
                                    <td>{{ booking.NrBoxes }}</td>
                                    <td>{{ booking.NrStudents }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <h1>Anmälningar till kurser</h1>
    <div class="row">
        {% for topic_id, registrations in courseRegistrations %}
            {% set topic = formatted['topics'][topic_id] %}
            <div class="col-sm-4">
                <div class="card">
                    <div class="card-header">{{ topic }}</div>
                    <div class="card-body">
                        <ul>
                            {% for registration in registrations %}
                                <li>{{ registration.User.FullName }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}

